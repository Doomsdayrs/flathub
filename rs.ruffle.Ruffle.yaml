app-id: rs.ruffle.Ruffle
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
#sdk-extensions:
#  -  org.freedesktop.Sdk.Extension.rust-stable
command: ruffle

finish-args:
  - --socket=wayland
# <x11
  - --socket=x11 # required for arboard fault
  - --share=ipc
# x11>
  - --socket=pulseaudio
  - --share=network # Flash can connect to the internet
  - --device=all # controllers (?)

#build-options:
#  append-path: /usr/lib/sdk/rust-stable/bin
#  env:
#    CARGO_HOME: /run/build/ruffle/cargo

modules:
  - name: rust
    buildsystem: simple
    build-commands:
      - install -D -t "${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/" ./rs.ruffle.Ruffle.svg
      - install -D -t "${FLATPAK_DEST}/share/applications/" ./rs.ruffle.Ruffle.desktop
      - install -D -t "${FLATPAK_DEST}/share/metainfo/" ./rs.ruffle.Ruffle.metainfo.xml
      - install -D -t "${FLATPAK_DEST}/bin/" ./ruffle
    sources:
      - type: file
        path: rs.ruffle.Ruffle.metainfo.xml
      - type: file
        path: rs.ruffle.Ruffle.desktop
      - type: file
        path: assets/logo.svg  # Waiting for PR merge https://github.com/ruffle-rs/ruffle/pull/11226
#         url: https://raw.githubusercontent.com/ruffle-rs/ruffle/nightly-2023-01-19/desktop/assets/Assets.xcassets/RuffleMacIcon.iconset/icon_512x512.png
#         sha256: b29ba1bf4f79a2c1c2526426b625ea3fef9193ba8f0bdc0e64be1db8beb612fd
        dest-filename: rs.ruffle.Ruffle.svg
      - type: archive
        url: https://github.com/ruffle-rs/ruffle/releases/download/nightly-2023-05-30/ruffle-nightly-2023_05_30-linux-x86_64.tar.gz
        sha256: dda7c9a6f4d959d40ba5760632a8109c51a4fcf464d00bf2deafc7586816538a
        strip-components: 0
        x-checker-data:
          type: html
          url: https://ruffle.rs/
          pattern: (https:\/\/github\.com\/ruffle-rs\/ruffle\/releases\/download\/.+\/ruffle-nightly-(\d{4}_\d{2}_\d{2})-linux-x86_64\.tar\.gz)

         # TODO FEDC

# TODO build from source
#  - name: ruffle
#    buildsystem: simple
#    build-commands:
#      - pwd
#      - ls $CARGO_HOME
#      - cargo --offline fetch --manifest-path Cargo.toml
#      - cargo --offline build --release --package=ruffle_desktop
#    sources:
#      - cargo-sources.json
#      - type: git
#        url: https://github.com/ruffle-rs/ruffle.git
#        tag: nightly-2023-01-19

# Credits to github/nickavem for the script, Doomsdayrs for edits

app-id: com.nonpolynomial.intiface_central
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk

command: intiface_central

finish-args:
  - --socket=wayland # Gamescope
  - --share=network # Run server
  - --allow=bluetooth
  - --socket=system-bus
  - --device=dri

modules:
  - name: intiface
    buildsystem: simple
    build-commands:
      # Create bin
      - mkdir -p /app/bin/

      # Move lib to proper directory
      - mkdir -p /app/lib/
      - mv lib/* /app/lib/
      - ln -s /app/lib /app/bin/lib
      
      # Move data in
      - mv data /app/bin/
      - install -D intiface_central /app/bin/

      # Metainfo
      - mkdir -p /app/share/metainfo/
      - install -D com.nonpolynomial.intiface_central.metainfo.xml /app/share/metainfo/

      # desktop
      - mkdir -p /app/share/applications/
      - install -D com.nonpolynomial.intiface_central.desktop /app/share/applications/

      # Icon
      - mkdir -p /app/share/icons/hicolor/512x512/apps
      - install -D com.nonpolynomial.intiface_central.png /app/share/icons/hicolor/512x512/apps/
    sources:
      # Logo
      - type: file
        url: https://github.com/intiface/intiface-central/raw/v2.3.0/assets/icons/intiface_central_icon.png
        dest-filename: com.nonpolynomial.intiface_central.png
        sha256: cb91343d3697ccc4abc74b999cfa8a5efa30e08286cf2ab4c6b2f61b7aeb7251

      # Metainfo
      - type: file
        path: com.nonpolynomial.intiface_central.metainfo.xml

      # Desktop
      - type: file
        path: com.nonpolynomial.intiface_central.desktop

      # App
      - type: archive
        url: https://github.com/intiface/intiface-central/releases/download/v2.4.3/intiface-central-v2.4.3-linux-x64.zip
        tag: v2.3.0
        sha256: f622389dc36e7343565148739e7736910d42ea59ce9dea046d1282ec03179ee1
        x-checker-data:
          type: json
          url: https://api.github.com/repos/intiface/intiface-central/releases/latest
          version-query: .name | sub("^.*v"; "")
          url-query: .assets[] | select(.name=="intiface-central-v" + $version + "-linux-x64.zip")
            | .browser_download_url
